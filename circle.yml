machine:
  services:
    - docker
  environment:
    PROJECT_NAME: organization_svc
dependencies:
  cache_directories:
    - ~/flatbuffers
  pre:
    - if [[ ! -e ~/flatbuffers/flatc ]]; then cd ~ && git clone https://github.com/google/flatbuffers.git && cd flatbuffers/ && cmake -G "Unix Makefiles" && make; fi
    - cp -f ~/flatbuffers/flatc ~/bin
    - flatc -g -o ~/.go_workspace/src/github.com/knollit/$CIRCLE_PROJECT_REPONAME/ *.fbs
test:
  post:
    - mv test.log $CIRCLE_ARTIFACTS/
deployment:
  production:
    branch: master
    commands:
      - make publish
